name: Unit Test

on:
  push:
    branches:
    - master
  pull_request:
    branches:
    - master

jobs:
  test-tf-1:
    runs-on: ubuntu-latest
    strategy:
      max-parallel: 4
      matrix:
        tf-version:
        - 1.14.0
        - 1.15.0
    container: tensorflow/tensorflow:${{matrix.tf-version}}-py3
    steps:
    - uses: actions/checkout@v1
    - name: Install Baseline
      run: |
        cd python
        pip install -e .[test,yaml]
    - name: Unit Test Tf ${{matrix.tf-version}}
      run: |
        cd python
        pytest --forked

  test-tf-2:
    runs-on: ubuntu-latest
    strategy:
      max-parallel: 4
      matrix:
        tf-version:
        - 2.0.0
    container: tensorflow/tensorflow:${{matrix.tf-version}}-py3
    steps:
    - uses: actions/checkout@v1
    - name: Install Baseline
      run: |
        cd python
        pip install -e .[test,yaml,tf2]
    - name: Unit Test Tf ${{matrix.tf-version}}
      run: |
        cd python
        pytest --forked

  test-pyt:
    runs-on: ubuntu-latest
    strategy:
      max-parallel: 4
      matrix:
        pyt-version:
        - 1.0-cuda10.0-cudnn7-runtime
        - 1.1.0-cuda10.0-cudnn7.5-runtime
        - 1.2-cuda10.0-cudnn7-runtime
    container: pytorch/pytorch:${{matrix.pyt-version}}
    steps:
    - uses: actions/checkout@v1
    - name: Install Baseline
      run: |
        cd python
        pip install -e .[test,yaml,tf2]
    - name: Unit Test PyTorch ${{matrix.pyt-version}}
      run: |
        cd python
        pytest --forked
